---
title: "RSpec: to be_within().of()"
layout: default
---

Как вы прекрасно знаете, в комплуктерах `0,1 + 0,2 ≠ 0,3`. Аналогичные проблемы есть и в любых других вычислениях, связанных с дробями (считай, с числами с плавающей запятой). Поэтому в тестах никогда нельзя напрямую сравнивать дробные результаты вычислений.

Используйте `be_within(delta).of(expected)` — матчер, проверяющий, что полученное число находится в окрестности радиусом delta от нужного:
```ruby
expect(score).to be_within(0.0001).of(2.19)
```

Аналогичная история и со временем: в Руби Time имеет точность до наносекунд, а БД — до микросекунд или секунд. В таких случаях приходится сравнивать приведением к юникстайму:
```ruby
expect(deadline.to_i).to eq Time.new(2022, 7, 7).to_i
```

Или тем же матчером:
```ruby
expect(deadline).to be_within(1.second).of(Time.new(2022, 7, 7))
```

И конечно, если работаете с деньгами, берите `BigDecimal`.
